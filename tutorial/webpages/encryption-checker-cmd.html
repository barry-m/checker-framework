<!DOCTYPE html>
<html lang="en">
<head>
<title>Checker Framework Tutorial - Writing an Encryption Checker - Command Line</title>

<link href="bootstrap/css/bootstrap.css" rel="stylesheet" />
<script type="text/javascript" src="bootstrap/js/bootstrap.min.js"></script>

<link href="css/main.css" rel="stylesheet" />
<link rel="icon" type="image/png" href="http://types.cs.washington.edu/checker-framework/favicon-checkerframework.png" />

</head>

<body>

 <div class="top_liner"></div>
 <div class="navbar navbar-inverse navbar-fixed-top" style="border-bottom: 1px solid #66d;">
  <div class="navbar-inner">
   <div class="contained">
    <ul class="nav">
     <li class="heading">Checker Framework:
      </h4>
     </li>
     <li><a href="http://checkerframework.org/">Main Site</a></li>
     <li><a href="http://types.cs.washington.edu/checker-framework/current/checker-framework-manual.html">Manual</a></li>
     <li><a href="https://groups.google.com/forum/?fromgroups#!forum/checker-framework-discuss">Discussion List</a></li>
     <li><a href="http://code.google.com/p/checker-framework/issues/list">Issue Tracker</a></li>
     <li><a href="http://code.google.com/p/checker-framework/source/checkout">Source Code</a></li>
     <li><a href="http://types.cs.washington.edu/checker-framework/eclipse/">Eclipse Plugin</a></li>
     <li class="active"><a href="http://types.cs.washington.edu/checker-framework/tutorial/">Tutorial</a></li>
    </ul>
   </div>
  </div>
 </div>
	<img src="CFLogo.png" alt="Checker Framework logo" />
	<div class="page-header short"
		style="border-bottom: 1px solid #EEE; border-top: none;">
		<h1>Checker Framework Tutorial</h1>
		<h2>
			<small>Previous <a href="security-error-cmd.html">Finding
					a Security Error</a>, Download
					<a href="../sourcefiles.zip">
					Example Sources</a></small>
		</h2>
	</div>

	<section id="top">
		<div class="page-header short" style="border-top: none;">

			<h2>
				Writing an Encryption Checker <small><em> Optional</em></small>
			</h2>
		</div>

		<section id="introduction">
			<p>This section of the tutorial is only for those who are
				interested in writing their own type-checkers. Please feel free to
				skip this section.</p>

			<!--Copied from the manual-->
			<p>
				Although the Checker Framework ships with <a
					href="http://types.cs.washington.edu/checker-framework/current/checker-framework-manual.html#introduction">several
					checkers</a>, it is often useful to write a custom checker.
				Perhaps there are other runtime exceptions you wish to prevent, or
				other properties of data that should always hold.
				In such cases, you can write your own type-checker.
				This section of the tutorial is for those who are
				interested in writing their own type-checkers. If you do not wish to
				write a new type-checker, feel free to skip this section of the tutorial.
			</p>

				<p>Suppose that you wish to only allow encrypted information to
					be sent over the internet. To do so, you can write an Encryption
					Checker.</p>
		</section>

		<section id="outline">
			<div class="well">
				<h5>Outline</h5>
				<ol>
					<li><a href="#annotation">Write type annotation definitions</a></li>
					<li><a href="#run1">Run the Encryption Checker</a>--2 errors</li>
					<li><a href="#error1">Suppress the first error</a></li>
					<li><a href="#run2">Run the Encryption Checker</a>--1 error</li>
					<li><a href="#error2">Correct the second error</a></li>
				</ol>
			</div>
		</section>
		<section id="annotation">
			<h4>1. Write the type annotation definitions</h4>
			<p>
				For this example, the annotation definitions have already been
				written, Encrypted.java and PossiblyUnencrypted.java. Please see the <a
					href="http://types.cs.washington.edu/checker-framework/current/checker-framework-manual.html#writing-a-checker">
					manual</a> for further explanation of this file.
			</p>

			<p>This code needs to be compiled with the Checker Framework
				compiler.</p>
			<pre>
$ <strong>javacheck myqual/Encrypted.java</strong>
$ <strong>javacheck myqual/PossiblyUnencrypted.java<strong>
                </pre>
			<p>The resulting .class files should either be on your classpath,
				or on the processor path (set via the -processorpath command-line
				option to javac).</p>
		</section>
		<section id="run1">
			<h4>2. Run the Encryption Checker</h4>

			<p>
				The
				<code>@Encrypted</code>
				annotations have already been written in EncryptionDemo.java.  The default for types
				without annotations is <code>@PossiblyUnencrypted</code>.
			</p>

			<p>
				<b>Invoke the compiler</b> with the Subtyping Checker, specifying the @Encrypted and @PossiblyUnencrypted
				annotations using the -Aquals command-line option, and adding the Encrypted and PossiblyUnencrypted
				classfiles to the processor classpath:
			</p>

			<pre>
$ <strong>javacheck  -processor org.checkerframework.common.subtyping.SubtypingChecker -Aquals=myqual.Encrypted,myqual.PossiblyUnencrypted encrypted/EncryptionDemo.java</strong>
encrypted/EncryptionDemo.java:21: error: [assignment.type.incompatible] incompatible types in assignment.
        /*@Encrypted*/ int encryptInt = (character + OFFSET) % Character.MAX_VALUE ;
                                                             ^
  found   : @PossiblyUnencrypted int
  required: @Encrypted int
encrypted/EncryptionDemo.java:32: error: [argument.type.incompatible] incompatible types in argument.
        sendOverInternet(password);
                         ^
  found   : @PossiblyUnencrypted String
  required: @Encrypted String
2 errors
</pre>
		</section>
		<section id="error1">
			<h4>4. Suppress the First Error</h4>


			<p>The first error needs to be suppressed, because the string on
				the left is considered "encrypted" in this encryption scheme. All
				<code>@SuppressWarnings</code> should have a comment explaining why suppressing
				the warning is the correct action. See the correction below.</p>


			<pre>
// The SuppressWarnings is necessary because the type system is not capable of
// validating that the return value is encrypted. -SOM 01/25/2013
@SuppressWarnings("encrypted")
private /*@Encrypted*/ char encryptCharacter(char character) {
</pre>
		</section>

		<section id="run2">
			<h4>5. Run the Encryption Checker</h4>

			<p>You will see the following error:</p>

			<pre>
encrypted/EncryptionDemo.java:34: error: [argument.type.incompatible] incompatible types in argument.
        sendOverInternet(password);
                         ^
  found   : @PossiblyUnencrypted String
  required: @Encrypted String
1 error
</pre>

			<p>This is a real error, because the programmer is trying to send
				a password over the internet without encrypting it first.</p>
		</section>
		<section id="error2">
			<h4>6. Correct the Second Error</h4>
			<p>The password should be encrypted before it is sent over the
				internet. The correction is below.</p>
			<pre>
void sendPassword() {
    String password = getUserPassword();
    sendOverInternet(encrypt(password));
}
</pre>
		</section>

		<section id="bottom">
			<div class="page-header short">
				<h2>
					The End of the Checker Framework Tutorial<small><strong>
							Return to the <a href="../index.html">main page</a> of the
							Tutorial.</strong></small>
				</h2>
			</div>

		</section>
		<!--
             <div class="bottom_liner well">
             <a href="#">Top</a>
             </div>
             -->
</body>
</html>

<!--  LocalWords:  Plugin plugin VM SDK plugins quals classpath
 -->
<!--  LocalWords:  NullnessChecker plugin's hg
 -->
